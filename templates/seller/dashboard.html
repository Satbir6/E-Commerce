<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>QuickCart - Seller Dashboard</title>
    <link
      rel="icon"
      href="{{url_for('static',filename='dist/images/logo-removebg.png')}}"
      type="image/png"
    />
    <link
      rel="stylesheet"
      href="{{url_for('static',filename='dist/css/output.css')}}"
    />
  </head>

  <body class="bg-gray-50">
    {% include 'components/navbar.html' %}
    <!-- Main Content -->
    <div class="p-4 pt-20">
      <!-- Stats Overview -->
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-4">
        <div class="bg-white rounded-lg shadow p-4">
          <div class="flex items-center">
            <div
              class="inline-flex flex-shrink-0 justify-center items-center w-12 h-12 text-blue-600 bg-blue-100 rounded-lg"
            >
              <svg
                class="w-6 h-6"
                fill="currentColor"
                viewBox="0 0 20 20"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M8.433 7.418c.155-.103.346-.196.567-.267v1.698a2.305 2.305 0 01-.567-.267C8.07 8.34 8 8.114 8 8c0-.114.07-.34.433-.582zM11 12.849v-1.698c.22.071.412.164.567.267.364.243.433.468.433.582 0 .114-.07.34-.433.582a2.305 2.305 0 01-.567.267z"
                ></path>
                <path
                  fill-rule="evenodd"
                  d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-13a1 1 0 10-2 0v.092a4.535 4.535 0 00-1.676.662C6.602 6.234 6 7.009 6 8c0 .99.602 1.765 1.324 2.246.48.32 1.054.545 1.676.662v1.941c-.391-.127-.68-.317-.843-.504a1 1 0 10-1.51 1.31c.562.649 1.413 1.076 2.353 1.253V15a1 1 0 102 0v-.092a4.535 4.535 0 001.676-.662C13.398 13.766 14 12.991 14 12c0-.99-.602-1.765-1.324-2.246A4.535 4.535 0 0011 9.092V7.151c.391.127.68.317.843.504a1 1 0 101.511-1.31c-.563-.649-1.413-1.076-2.354-1.253V5z"
                  clip-rule="evenodd"
                ></path>
              </svg>
            </div>
            <div class="ml-4">
              <h3 class="mb-2 text-xl font-medium">Total Earnings</h3>
              <p class="text-2xl font-semibold text-gray-900">
                ₹{{user.earning}}
              </p>
            </div>
          </div>
        </div>

        <div class="bg-white rounded-lg shadow p-4">
          <div class="flex items-center">
            <div
              class="inline-flex flex-shrink-0 justify-center items-center w-12 h-12 text-green-600 bg-green-100 rounded-lg"
            >
              <svg
                class="w-6 h-6"
                fill="currentColor"
                viewBox="0 0 20 20"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  fill-rule="evenodd"
                  d="M10 2a4 4 0 00-4 4v1H5a1 1 0 00-.994.89l-1 9A1 1 0 004 18h12a1 1 0 00.994-1.11l-1-9A1 1 0 0015 7h-1V6a4 4 0 00-4-4zm2 5V6a2 2 0 10-4 0v1h4zm-6 3a1 1 0 112 0 1 1 0 01-2 0zm7-1a1 1 0 100 2 1 1 0 000-2z"
                  clip-rule="evenodd"
                ></path>
              </svg>
            </div>
            <div class="ml-4">
              <h3 class="mb-2 text-xl font-medium">Total Products</h3>
              <p class="text-2xl font-semibold text-gray-900">
                {{products|length}}
              </p>
            </div>
          </div>
        </div>

        <div class="bg-white rounded-lg shadow p-4">
          <div class="flex items-center">
            <div
              class="inline-flex flex-shrink-0 justify-center items-center w-12 h-12 text-yellow-600 bg-yellow-100 rounded-lg"
            >
              <svg
                class="w-6 h-6"
                fill="currentColor"
                viewBox="0 0 20 20"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  fill-rule="evenodd"
                  d="M3 3a1 1 0 000 2v8a2 2 0 002 2h2.586l-1.293 1.293a1 1 0 101.414 1.414L10 15.414l2.293 2.293a1 1 0 001.414-1.414L12.414 15H15a2 2 0 002-2V5a1 1 0 100-2H3zm11 4a1 1 0 10-2 0v4a1 1 0 102 0V7zm-3 1a1 1 0 10-2 0v3a1 1 0 102 0V8zM8 9a1 1 0 00-2 0v2a1 1 0 102 0V9z"
                  clip-rule="evenodd"
                ></path>
              </svg>
            </div>
            <div class="ml-4">
              <h3 class="mb-2 text-xl font-medium">Pending Orders</h3>
              <p class="text-2xl font-semibold text-gray-900">
                {{pending_orders|length}}
              </p>
            </div>
          </div>
        </div>

        <div class="bg-white rounded-lg shadow p-4">
          <div class="flex items-center">
            <div
              class="inline-flex flex-shrink-0 justify-center items-center w-12 h-12 text-red-600 bg-red-100 rounded-lg"
            >
              <svg
                class="w-6 h-6"
                fill="currentColor"
                viewBox="0 0 20 20"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  fill-rule="evenodd"
                  d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z"
                  clip-rule="evenodd"
                ></path>
              </svg>
            </div>
            <div class="ml-4">
              <h3 class="mb-2 text-xl font-medium">Low Stock Items</h3>
              <p class="text-2xl font-semibold text-gray-900">
                {{low_stock_products|length}}
              </p>
            </div>
          </div>
        </div>
      </div>

      <!-- Products Section -->
      <div id="products" class="bg-white rounded-lg shadow p-4 mb-4">
        <div class="flex justify-between items-center mb-4">
          <h2 class="text-xl font-bold">Your Products</h2>
          <button
            data-modal-target="add-product-modal"
            data-modal-toggle="add-product-modal"
            class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700"
          >
            Add New Product
          </button>
        </div>

        <div class="relative overflow-x-auto">
          <table class="w-full text-sm text-left text-gray-500">
            <thead class="text-xs text-gray-700 uppercase bg-gray-50">
              <tr>
                <th scope="col" class="px-6 py-3">Product name</th>
                <th scope="col" class="px-6 py-3">Category</th>
                <th scope="col" class="px-6 py-3">Stock</th>
                <th scope="col" class="px-6 py-3">Price</th>
                <th scope="col" class="px-6 py-3">Actions</th>
              </tr>
            </thead>
            <tbody>
              {% for product in products %}
              <tr class="bg-white border-b">
                <td
                  class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap"
                >
                  {{product.name}}
                </td>
                <td class="px-6 py-4">{{product.category}}</td>
                <td class="px-6 py-4">{{product.stock}}</td>
                <td class="px-6 py-4">₹{{product.price}}</td>
                <td class="px-6 py-4">
                  <button
                    data-modal-target="edit-product-modal-{{product.id}}"
                    data-modal-toggle="edit-product-modal-{{product.id}}"
                    class="font-medium text-blue-600 hover:underline"
                  >
                    Edit
                  </button>
                  <button
                    onclick="deleteProduct('{{product.id}}')"
                    class="font-medium text-red-600 hover:underline ml-3"
                  >
                    Delete
                  </button>
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>

      <!-- Orders Section -->
      <div id="orders" class="bg-white rounded-lg shadow p-4">
        <h2 class="text-xl font-bold mb-4">Recent Orders</h2>
        <div class="relative overflow-x-auto">
          <table class="w-full text-sm text-left text-gray-500">
            <thead class="text-xs text-gray-700 uppercase bg-gray-50">
              <tr>
                <th scope="col" class="px-6 py-3">Order ID</th>
                <th scope="col" class="px-6 py-3">Customer</th>
                <th scope="col" class="px-6 py-3">Date</th>
                <th scope="col" class="px-6 py-3">Status</th>
                <th scope="col" class="px-6 py-3">Total</th>
                <th scope="col" class="px-6 py-3">Actions</th>
              </tr>
            </thead>
            <tbody>
              {% for order in orders %}
              <tr class="bg-white border-b">
                <td class="px-6 py-4">#{{order.id}}</td>
                <td class="px-6 py-4">
                  {{order.user.first_name}} {{order.user.last_name}}
                </td>
                <td class="px-6 py-4">
                  {{order.created_at.strftime('%Y-%m-%d')}}
                </td>
                <td class="px-6 py-4">
                  <span
                    class="px-2 py-1 rounded-full text-xs {% if order.status == 'Pending' %}bg-yellow-100 text-yellow-800 {% elif order.status == 'Completed' %}bg-green-100 text-green-800 {% elif order.status == 'Cancelled' %}bg-red-100 text-red-800 {% endif %}"
                  >
                    {{order.status}}
                  </span>
                </td>
                <td class="px-6 py-4">₹{{order.total_price}}</td>
                <td class="px-6 py-4">
                  {% if order.status == 'Pending' %}
                  <button
                    onclick="updateOrderStatus('{{order.id}}', 'Completed')"
                    class="font-medium text-green-600 hover:underline"
                  >
                    Mark Complete
                  </button>
                  {% endif %}
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- Add Product Modal -->
    <div
      id="add-product-modal"
      tabindex="-1"
      aria-hidden="true"
      class="fixed top-0 left-0 right-0 z-50 hidden w-full p-4 overflow-x-hidden overflow-y-auto md:inset-0 h-[calc(100%-1rem)] max-h-full m-10"
    >
      <!-- Modal content -->
      <div class="relative w-full max-w-md max-h-full">
        <div class="relative bg-white rounded-lg shadow">
          <button
            type="button"
            class="absolute top-3 right-2.5 text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm w-8 h-8 ml-auto inline-flex justify-center items-center"
            data-modal-hide="add-product-modal"
          >
            <svg
              class="w-3 h-3"
              aria-hidden="true"
              xmlns="http://www.w3.org/2000/svg"
              fill="none"
              viewBox="0 0 14 14"
            >
              <path
                stroke="currentColor"
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"
              />
            </svg>
          </button>
          <div class="px-6 py-6 lg:px-8">
            <h3 class="mb-4 text-xl font-medium text-gray-900">
              Add New Product
            </h3>
            <form
              class="space-y-6"
              action="{{url_for('add_product')}}"
              method="POST"
              enctype="multipart/form-data"
            >
              <div>
                <label
                  for="name"
                  class="block mb-2 text-sm font-medium text-gray-900"
                  >Product Name</label
                >
                <input
                  type="text"
                  name="name"
                  id="name"
                  class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5"
                  required
                />
              </div>
              <div>
                <label
                  for="description"
                  class="block mb-2 text-sm font-medium text-gray-900"
                  >Description</label
                >
                <textarea
                  name="description"
                  id="description"
                  rows="3"
                  class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5"
                  required
                ></textarea>
              </div>
              <div>
                <label
                  for="category"
                  class="block mb-2 text-sm font-medium text-gray-900"
                  >Category</label
                >
                <select
                  name="category"
                  id="category"
                  class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5"
                  required
                >
                  <option value="">Select a category</option>
                  <!-- Electronics -->
                  <optgroup label="Electronics">
                    <option value="Mobile Phones">Mobile Phones</option>
                    <option value="Laptops">Laptops</option>
                    <option value="Tablets">Tablets</option>
                    <option value="Accessories">Accessories</option>
                  </optgroup>
                  <!-- Fashion -->
                  <optgroup label="Fashion">
                    <option value="Men">Men</option>
                    <option value="Women">Women</option>
                    <option value="Kids">Kids</option>
                    <option value="Shoes">Shoes</option>
                  </optgroup>
                  <!-- Home & Kitchen -->
                  <optgroup label="Home & Kitchen">
                    <option value="Appliances">Appliances</option>
                    <option value="Furniture">Furniture</option>
                    <option value="Home Decor">Home Decor</option>
                    <option value="Kitchenware">Kitchenware</option>
                  </optgroup>
                </select>
              </div>
              <div>
                <label
                  for="price"
                  class="block mb-2 text-sm font-medium text-gray-900"
                  >Price</label
                >
                <input
                  type="number"
                  name="price"
                  id="price"
                  step="0.01"
                  class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5"
                  required
                />
              </div>
              <div>
                <label
                  for="stock"
                  class="block mb-2 text-sm font-medium text-gray-900"
                  >Stock</label
                >
                <input
                  type="number"
                  name="stock"
                  id="stock"
                  class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5"
                  required
                />
              </div>
              <div>
                <label
                  for="image"
                  class="block mb-2 text-sm font-medium text-gray-900"
                  >Product Image</label
                >

                <input
                  class="block w-full text-sm text-gray-900 border border-gray-300 rounded-lg cursor-pointer bg-gray-50 dark:text-gray-400 focus:outline-none dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400"
                  type="file"
                  name="image"
                  id="image"
                  accept="image/*"
                />
              </div>
              <button
                type="submit"
                class="w-full text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center"
              >
                Add Product
              </button>
            </form>
          </div>
        </div>
      </div>
    </div>

    <!-- Edit Product Modal -->
    {% for product in products %}
    <div
      id="edit-product-modal-{{product.id}}"
      tabindex="-1"
      aria-hidden="true"
      class="fixed top-0 left-0 right-0 z-50 hidden w-full p-4 overflow-x-hidden overflow-y-auto md:inset-0 h-[calc(100%-1rem)] max-h-full m-10"
    >
      <div class="relative w-full max-w-md max-h-full">
        <div class="relative bg-white rounded-lg shadow">
          <button
            type="button"
            class="absolute top-3 right-2.5 text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm w-8 h-8 ml-auto inline-flex justify-center items-center"
            data-modal-hide="edit-product-modal-{{product.id}}"
          >
            <svg
              class="w-3 h-3"
              aria-hidden="true"
              xmlns="http://www.w3.org/2000/svg"
              fill="none"
              viewBox="0 0 14 14"
            >
              <path
                stroke="currentColor"
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"
              />
            </svg>
          </button>
          <div class="px-6 py-6 lg:px-8">
            <h3 class="mb-4 text-xl font-medium text-gray-900">Edit Product</h3>
            <form
              class="space-y-6"
              action="{{url_for('edit_product', product_id=product.id)}}"
              method="POST"
              enctype="multipart/form-data"
            >
              <div>
                <label
                  for="edit-name-{{product.id}}"
                  class="block mb-2 text-sm font-medium text-gray-900"
                  >Product Name</label
                >
                <input
                  type="text"
                  name="name"
                  id="edit-name-{{product.id}}"
                  value="{{product.name}}"
                  class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5"
                  required
                />
              </div>
              <div>
                <label
                  for="edit-description-{{product.id}}"
                  class="block mb-2 text-sm font-medium text-gray-900"
                  >Description</label
                >
                <textarea
                  name="description"
                  id="edit-description-{{product.id}}"
                  rows="3"
                  class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5"
                  required
                >
{{product.description}}</textarea
                >
              </div>
              <div>
                <label
                  for="edit-category-{{product.id}}"
                  class="block mb-2 text-sm font-medium text-gray-900"
                  >Category</label
                >
                <select
                  name="category"
                  id="edit-category-{{product.id}}"
                  class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5"
                  required
                >
                  <!-- Same options as add product modal -->
                  <option value="{{product.category}}" selected>
                    {{product.category}}
                  </option>
                  <!-- Add all other category options here -->
                </select>
              </div>
              <div>
                <label
                  for="edit-price-{{product.id}}"
                  class="block mb-2 text-sm font-medium text-gray-900"
                  >Price</label
                >
                <input
                  type="number"
                  name="price"
                  id="edit-price-{{product.id}}"
                  value="{{product.price}}"
                  step="0.01"
                  class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5"
                  required
                />
              </div>
              <div>
                <label
                  for="edit-stock-{{product.id}}"
                  class="block mb-2 text-sm font-medium text-gray-900"
                  >Stock</label
                >
                <input
                  type="number"
                  name="stock"
                  id="edit-stock-{{product.id}}"
                  value="{{product.stock}}"
                  class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5"
                  required
                />
              </div>
              <div>
                <label
                  for="edit-image-{{product.id}}"
                  class="block mb-2 text-sm font-medium text-gray-900"
                  >Product Image</label
                >
                <input
                  class="block w-full text-sm text-gray-900 border border-gray-300 rounded-lg cursor-pointer bg-gray-50 focus:outline-none"
                  type="file"
                  name="image"
                  id="edit-image-{{product.id}}"
                  accept="image/*"
                />
                <p class="mt-1 text-sm text-gray-500">
                  Leave empty to keep current image
                </p>
              </div>
              <button
                type="submit"
                class="w-full text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center"
              >
                Update Product
              </button>
            </form>
          </div>
        </div>
      </div>
    </div>
    {% endfor %}

    <script src="https://cdn.jsdelivr.net/npm/flowbite@2.5.2/dist/flowbite.min.js"></script>
    <script>
      // Toggle user dropdown
      const userMenuButton = document.getElementById("user-menu-button");
      const userDropdown = document.getElementById("dropdown-user");

      userMenuButton.addEventListener("click", () => {
        userDropdown.classList.toggle("hidden");
      });

      // Close dropdown when clicking outside
      document.addEventListener("click", (event) => {
        if (
          !userMenuButton.contains(event.target) &&
          !userDropdown.contains(event.target)
        ) {
          userDropdown.classList.add("hidden");
        }
      });

      // Delete product function
      function deleteProduct(productId) {
        if (confirm("Are you sure you want to delete this product?")) {
          fetch(`/delete_product/${productId}`, {
            method: "POST",
          }).then((response) => {
            if (response.ok) {
              window.location.reload();
            }
          });
        }
      }

      // Update order status function
      function updateOrderStatus(orderId, status) {
        fetch(`/update_order_status/${orderId}`, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({ status: status }),
        }).then((response) => {
          if (response.ok) {
            window.location.reload();
          }
        });
      }
    </script>
  </body>
</html>
